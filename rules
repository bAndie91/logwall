##
## logwall(1) ruleset file
##
## Syntax:
##   <keyword><operator><value>
## There can be more keyword-operator-value triplets in one line
## delimited by whitespace.
##
## Keywords:
##
##   Testing keywords:
##     Log message's attributes:
##       facility**, severity**, level**, tag, sourcename, ident, pid*, msg
##     Logging process' attributes:
##       realpid*, puid*, pgid*, powner, pgroup, exe
##     Process' executable file's attributes:
##       uid*, gid*, owner, group
##
##     *=Takes numeric value
##     **=Takes numeric value or facility/serverity name
##     aliases: severity = level, sourcename = ident
##
##   Action keywords:
##     then, log, rwlog
##
## Operators:
##   ==  equal
##   !=  not equal
##   =~  regexp match
##   !~  regexp not match
##   =*  case insensitive regexp match
##   !*  case insensitive regexp not match
##   <   less
##   >   greater
##   <=  less or equal
##   >=  greater or equal
##   :=  rewrite
##   ^=  prepend
##   +=  append
##   :~  regexp substitution
##   =   other (use this for then, log and rwlog keywords)
##
## Name/number mapping:
##   facility:
##     0	kern
##     1	user
##     2	mail
##     3	daemon
##     4	auth
##     5	syslog
##     6	lpr
##     7	news
##     8	uucp
##     9	cron
##     10	authpriv
##     11	ftp
##     12	ntp
##     13	audit
##     14	alert
##     15	clock
##     16	local0
##     17	local1
##     18	local2
##     19	local3
##     20	local4
##     21	local5
##     22	local6
##     23	local7
##   severity:
##     0	panic
##     0	emerg
##     1	alert
##     2	crit
##     3	err
##     3	error
##     4	warn
##     4	warning
##     5	notice
##     6	info
##     7	debug
##
## Rewritable properties:
##   Prependable, appendable:
##     tag, sourcename, msg
##   Only rewritable:
##     facility, severity, pid
##
## Variable substitution:
##   Testing keywords are substituted with theirs value, eg:
##   msg^="user={{powner}} "
##
## Regexp substitution:
##   Separate the pattern and the replacement with tilde `~' mark, eg:
##   msg:~error~ERROR
##   Use embedded notation for case insensitivity, eg:
##   msg:~(?i)error~ERROR
##   Use hex char notation to match tilde literally, eg:
##   msg:~\x7E~tilde
##   Substitution is global by default, be tricky if you have to, eg:
##   msg:~(?i)error(.*)~ERROR$1
##   Regexp variables usable in replacement string are limited to:
##   $1 .. $9, $+, $`, $& and $'
##
## Examples:
##   powner!=root then=drop
##   severity>crit then=accept
##   severity<=crit puid>=1000 log=info then=drop
##   sourcename==/USR/SBIN/CRON sourcename:=CRON rwlog=debug
##   powner==nobody log=debug,ALL,-comm,-args
##   msg^=test: rwlog=debug
##   msg^=test: rwlog=debug,ALL
##   msg^=test: rwlog=debug,ALLRW,powner,pgroup,exe
##


# log all logs
#log=debug rwlog=debug


# most system processes
puid<1000   then=accept

exe==/sbin/unix_chkpwd   then=accept

# we dont know the logger's credentials
exe==""	 severity<error  log=info   then=drop
powner==""  severity<error  log=info   then=drop

# allow only these for everyone else
facility==user   then=accept
facility>=local1  facility!=local3  facility<=local7   then=accept

# drop policy
log=notice then=drop

